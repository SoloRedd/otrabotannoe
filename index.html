<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>–£—á–µ—Ç —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 5px;
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 15px;
            font-size: 1.8rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        /* –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é */
        .role-switch {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .role-btn {
            padding: 12px 25px;
            font-size: 1rem;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            background: rgba(255,255,255,0.2);
            color: white;
            transition: all 0.3s ease;
            flex: 1;
            max-width: 200px;
            min-width: 120px;
        }

        .role-btn.active {
            background: white;
            color: #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding: 15px;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 20px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            transform: translateY(50px);
            transition: transform 0.3s ease;
            -webkit-overflow-scrolling: touch;
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            position: sticky;
            top: 0;
            background: white;
            z-index: 10;
        }

        .modal-header h3 {
            font-size: 1.3rem;
            color: #333;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: #666;
            padding: 5px 10px;
            line-height: 1;
        }

        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ */
        .employer-section, .employee-section, .employee-login-section {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .employer-section.active, .employee-section.active, .employee-login-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* –§–æ—Ä–º—ã */
        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
            font-size: 0.95rem;
        }

        select, input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            background: white;
        }

        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .time-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .allowances-grid, .deductions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 15px;
        }

        .allowances-grid {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
        }

        .deductions-grid {
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .section-title.allowances {
            color: #2e7d32;
        }

        .section-title.deductions {
            color: #c62828;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 14px 20px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 8px;
            -webkit-appearance: none;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn.secondary {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
        }

        .btn.danger {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
        }

        .btn.small {
            padding: 10px 15px;
            font-size: 0.9rem;
            width: auto;
        }

        /* –®–∞–ø–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ */
        .employee-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            color: white;
        }

        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .user-name {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            padding: 8px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .filter-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 120px;
        }

        .filter-group label {
            color: rgba(255,255,255,0.9);
            font-size: 0.85rem;
        }

        .filter-group input {
            background: rgba(255,255,255,0.9);
            border: none;
            padding: 10px;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            text-align: center;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #666;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
            word-break: break-word;
        }

        .stat-value.positive {
            color: #4caf50;
        }

        .stat-value.negative {
            color: #f44336;
        }

        .shifts-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        @media (min-width: 480px) {
            .shifts-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            }
        }

        .shift-card {
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .shift-card:active {
            background: #f8f9fa;
        }

        .shift-card.admin-card:active {
            border-color: #667eea;
        }

        .shift-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid #f0f0f0;
        }

        .shift-date {
            font-size: 1.1rem;
            font-weight: bold;
            color: #333;
        }

        .shift-day {
            font-size: 0.8rem;
            color: #666;
            background: #f0f0f0;
            padding: 4px 10px;
            border-radius: 20px;
        }

        .shift-preview {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .shift-time {
            text-align: center;
            flex: 1;
        }

        .time-label {
            font-size: 0.7rem;
            color: #666;
            margin-bottom: 3px;
        }

        .time-value {
            font-size: 1.1rem;
            font-weight: bold;
            color: #333;
        }

        .shift-arrow {
            font-size: 1.2rem;
            color: #667eea;
            margin: 0 5px;
        }

        .shift-total {
            text-align: right;
        }

        .total-label {
            font-size: 0.7rem;
            color: #666;
            margin-bottom: 3px;
        }

        .total-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #4caf50;
        }

        .shift-footer {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-top: 10px;
            padding-top: 8px;
            border-top: 2px solid #f0f0f0;
        }

        .shift-footer-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .shift-badge {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.85rem;
            padding: 4px 8px;
            background: #f8f9fa;
            border-radius: 20px;
        }

        .shift-badge.taxi {
            background: #fff3e0;
            color: #e65100;
        }

        .shift-badge.allowance {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .shift-badge.deduction {
            background: #ffebee;
            color: #c62828;
        }

        .comment-indicator {
            color: #ff9800;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .modal-details {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 12px;
            font-size: 0.95rem;
        }

        .detail-label {
            font-weight: 500;
            color: #666;
        }

        .detail-value {
            font-weight: bold;
            color: #333;
        }

        .detail-value.positive {
            color: #4caf50;
        }

        .detail-value.negative {
            color: #f44336;
        }

        .comment-box {
            background: #fff3e0;
            padding: 12px;
            border-radius: 12px;
            border-left: 4px solid #ff9800;
            margin-top: 5px;
        }

        .admin-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .admin-tab {
            padding: 10px 15px;
            background: none;
            border: none;
            font-size: 0.95rem;
            cursor: pointer;
            color: #666;
            border-radius: 10px 10px 0 0;
            white-space: nowrap;
        }

        .admin-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .admin-tab-content {
            display: none;
        }

        .admin-tab-content.active {
            display: block;
        }

        .employee-list {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 15px;
        }

        .employee-item {
            display: grid;
            grid-template-columns: 1fr 80px auto auto;
            gap: 5px;
            margin-bottom: 10px;
            align-items: center;
        }

        @media (max-width: 480px) {
            .employee-item {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .employee-item button {
                width: 100%;
            }
        }

        .admin-lock {
            position: fixed;
            bottom: 15px;
            right: 15px;
            background: white;
            padding: 8px 15px;
            border-radius: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 100;
            font-size: 0.85rem;
        }

        .admin-lock button {
            background: #667eea;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .no-data {
            text-align: center;
            padding: 40px 20px;
            color: #666;
            font-size: 1rem;
            background: #f8f9fa;
            border-radius: 15px;
        }

        .password-hint {
            font-size: 0.8em;
            color: #999;
            margin-top: 10px;
        }

        @media (max-width: 380px) {
            .stats-cards {
                grid-template-columns: 1fr 1fr;
            }
            
            .stat-value {
                font-size: 1.1rem;
            }
            
            .shift-preview {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .shift-time {
                min-width: 70px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä –£—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏</h1>
        
        <div class="role-switch">
            <button class="role-btn active" onclick="showEmployeeLogin()">–°–æ—Ç—Ä—É–¥–Ω–∏–∫</button>
            <button class="role-btn" id="adminBtn" onclick="showPasswordModal()">–ê–¥–º–∏–Ω</button>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
        <div id="adminPasswordModal" class="modal">
            <div class="modal-content">
                <h2>üîê –í—Ö–æ–¥ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
                <input type="password" id="adminPasswordInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" maxlength="10">
                <button class="btn" onclick="checkAdminPassword()">–í–æ–π—Ç–∏</button>
                <button class="btn secondary" onclick="hideAdminPasswordModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ -->
        <div id="employeeLoginModal" class="modal">
            <div class="modal-content">
                <h2>üë§ –í—Ö–æ–¥ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h2>
                <select id="employeeLoginSelect"></select>
                <input type="password" id="employeePasswordInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                <button class="btn" onclick="checkEmployeePassword()">–í–æ–π—Ç–∏</button>
                <button class="btn secondary" onclick="hideEmployeeLoginModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–º–µ–Ω—ã -->
        <div id="editShiftModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="editModalTitle">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–º–µ–Ω—ã</h3>
                    <button class="modal-close" onclick="closeEditModal()">√ó</button>
                </div>
                <div id="editShiftForm">
                    <input type="hidden" id="editShiftId">
                    
                    <div class="form-group">
                        <label>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</label>
                        <select id="editEmployeeSelect"></select>
                    </div>

                    <div class="form-group">
                        <label>–î–∞—Ç–∞ —Å–º–µ–Ω—ã</label>
                        <input type="date" id="editShiftDate">
                    </div>

                    <div class="time-inputs">
                        <div class="form-group">
                            <label>–ü—Ä–∏—à–µ–ª</label>
                            <input type="time" id="editStartTime">
                        </div>
                        <div class="form-group">
                            <label>–£—à–µ–ª</label>
                            <input type="time" id="editEndTime">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>–ß–∞—Å–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ (‚ÇΩ)</label>
                        <input type="number" id="editHourlyRate" min="0">
                    </div>

                    <div class="section-title allowances">‚ûï –ù–∞–¥–±–∞–≤–∫–∏</div>
                    <div class="allowances-grid">
                        <div class="form-group">
                            <label>üöñ –¢–∞–∫—Å–∏ (‚ÇΩ)</label>
                            <input type="number" id="editTaxi" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label>‚ûï –î—Ä—É–≥–∏–µ –Ω–∞–¥–±–∞–≤–∫–∏ (‚ÇΩ)</label>
                            <input type="number" id="editOtherAllowances" min="0" value="0">
                        </div>
                    </div>

                    <div class="section-title deductions">‚ûñ –£–¥–µ—Ä–∂–∞–Ω–∏—è</div>
                    <div class="deductions-grid">
                        <div class="form-group">
                            <label>‚ö†Ô∏è –®—Ç—Ä–∞—Ñ—ã (‚ÇΩ)</label>
                            <input type="number" id="editFines" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label>üìã –£–¥–µ—Ä–∂–∞–Ω–∏—è (‚ÇΩ)</label>
                            <input type="number" id="editDeductions" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label>üçΩÔ∏è –ü–∏—Ç–∞–Ω–∏–µ (‚ÇΩ)</label>
                            <input type="number" id="editMeals" min="0" value="0">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                        <textarea id="editComment" rows="3"></textarea>
                    </div>

                    <button class="btn" onclick="updateShift()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                    <button class="btn danger" onclick="deleteShift()" style="margin-top: 10px;">–£–¥–∞–ª–∏—Ç—å —Å–º–µ–Ω—É</button>
                    <button class="btn secondary" onclick="closeEditModal()" style="margin-top: 10px;">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ—Ç–∞–ª–µ–π —Å–º–µ–Ω—ã –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ -->
        <div id="shiftModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalDate">–î–µ—Ç–∞–ª–∏ —Å–º–µ–Ω—ã</h3>
                    <button class="modal-close" onclick="closeShiftModal()">√ó</button>
                </div>
                <div class="modal-details" id="modalDetails"></div>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –≤—Ö–æ–¥–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ -->
        <div id="employeeLoginSection" class="employee-login-section active">
            <h2>üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
            <p style="color: #666; margin-bottom: 30px;">–í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</p>
            <div class="form-group">
                <label>–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</label>
                <select id="employeeLoginSelectMain"></select>
            </div>
            <div class="form-group">
                <label>–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                <input type="password" id="employeePasswordInputMain" placeholder="–ü–∞—Ä–æ–ª—å">
            </div>
            <button class="btn" onclick="checkEmployeePasswordMain()">–í–æ–π—Ç–∏</button>
            <div class="password-hint">–ü–∞—Ä–æ–ª—å –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (–ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞) -->
        <div id="employeeSection" class="employee-section">
            <div class="employee-header">
                <div class="user-info">
                    <span class="user-name" id="currentEmployeeName"></span>
                    <button class="logout-btn" onclick="logoutEmployee()">–í—ã–π—Ç–∏</button>
                </div>
                <div class="filter-controls">
                    <div class="filter-group">
                        <label>–ü–µ—Ä–∏–æ–¥ —Å</label>
                        <input type="date" id="dateFrom" onchange="loadEmployeeShifts()">
                    </div>
                    <div class="filter-group">
                        <label>–ü–µ—Ä–∏–æ–¥ –ø–æ</label>
                        <input type="date" id="dateTo" onchange="loadEmployeeShifts()">
                    </div>
                    <button class="btn secondary small" onclick="resetDateFilter()">–°–±—Ä–æ—Å–∏—Ç—å</button>
                </div>
            </div>

            <div id="statsContainer" class="stats-cards"></div>
            <div id="shiftsGrid" class="shifts-grid"></div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è -->
        <div id="employerSection" class="employer-section">
            <h2 style="margin-bottom: 20px;">–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
            
            <div class="admin-tabs">
                <button class="admin-tab active" onclick="switchAdminTab('employees')">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</button>
                <button class="admin-tab" onclick="switchAdminTab('shifts')">–í—Å–µ —Å–º–µ–Ω—ã</button>
                <button class="admin-tab" onclick="switchAdminTab('add')">–î–æ–±–∞–≤–∏—Ç—å —Å–º–µ–Ω—É</button>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏ -->
            <div id="adminEmployeesTab" class="admin-tab-content active">
                <div class="employee-list">
                    <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏</h3>
                    <div id="employeesContainer"></div>
                    <button class="btn small" onclick="addNewEmployee()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</button>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö —Å–º–µ–Ω -->
            <div id="adminShiftsTab" class="admin-tab-content">
                <h3 style="margin-bottom: 20px;">–í—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Å–º–µ–Ω—ã</h3>
                <div class="filter-controls" style="margin-bottom: 20px;">
                    <div class="filter-group">
                        <label>–§–∏–ª—å—Ç—Ä –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É</label>
                        <select id="adminEmployeeFilter" onchange="loadAdminShifts()">
                            <option value="">–í—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>–ü–µ—Ä–∏–æ–¥ —Å</label>
                        <input type="date" id="adminDateFrom" onchange="loadAdminShifts()">
                    </div>
                    <div class="filter-group">
                        <label>–ü–µ—Ä–∏–æ–¥ –ø–æ</label>
                        <input type="date" id="adminDateTo" onchange="loadAdminShifts()">
                    </div>
                    <button class="btn secondary small" onclick="resetAdminFilter()">–°–±—Ä–æ—Å–∏—Ç—å</button>
                </div>
                <div id="adminShiftsGrid" class="shifts-grid"></div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å–º–µ–Ω—ã -->
            <div id="adminAddTab" class="admin-tab-content">
                <h3 style="margin-bottom: 20px;">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å–º–µ–Ω—É</h3>
                
                <div class="form-group">
                    <label>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</label>
                    <select id="employeeSelect"></select>
                </div>

                <div class="form-group">
                    <label>–î–∞—Ç–∞ —Å–º–µ–Ω—ã</label>
                    <input type="date" id="shiftDate">
                </div>

                <div class="time-inputs">
                    <div class="form-group">
                        <label>–ü—Ä–∏—à–µ–ª</label>
                        <input type="time" id="startTime" value="09:00">
                    </div>
                    <div class="form-group">
                        <label>–£—à–µ–ª</label>
                        <input type="time" id="endTime" value="18:00">
                    </div>
                </div>

                <div class="form-group">
                    <label>–ß–∞—Å–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ (‚ÇΩ)</label>
                    <input type="number" id="hourlyRate" value="500" min="0">
                </div>

                <div class="section-title allowances">‚ûï –ù–∞–¥–±–∞–≤–∫–∏</div>
                <div class="allowances-grid">
                    <div class="form-group">
                        <label>üöñ –¢–∞–∫—Å–∏ (‚ÇΩ)</label>
                        <input type="number" id="taxi" value="0" min="0">
                    </div>
                    <div class="form-group">
                        <label>‚ûï –î—Ä—É–≥–∏–µ –Ω–∞–¥–±–∞–≤–∫–∏ (‚ÇΩ)</label>
                        <input type="number" id="otherAllowances" value="0" min="0">
                    </div>
                </div>

                <div class="section-title deductions">‚ûñ –£–¥–µ—Ä–∂–∞–Ω–∏—è</div>
                <div class="deductions-grid">
                    <div class="form-group">
                        <label>‚ö†Ô∏è –®—Ç—Ä–∞—Ñ—ã (‚ÇΩ)</label>
                        <input type="number" id="fines" value="0" min="0">
                    </div>
                    <div class="form-group">
                        <label>üìã –£–¥–µ—Ä–∂–∞–Ω–∏—è (‚ÇΩ)</label>
                        <input type="number" id="deductions" value="0" min="0">
                    </div>
                    <div class="form-group">
                        <label>üçΩÔ∏è –ü–∏—Ç–∞–Ω–∏–µ (‚ÇΩ)</label>
                        <input type="number" id="meals" value="0" min="0">
                    </div>
                </div>

                <div class="form-group">
                    <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ —Å–º–µ–Ω–µ</label>
                    <textarea id="shiftComment" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..."></textarea>
                </div>

                <button class="btn" onclick="saveShift()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–º–µ–Ω—É</button>
            </div>

            <button class="btn secondary" style="margin-top: 20px;" onclick="logoutAdmin()">–í—ã–π—Ç–∏ –∏–∑ —Ä–µ–∂–∏–º–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</button>
        </div>

        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
        <div id="adminLock" class="admin-lock">
            <span id="adminStatus">üë§ –†–µ–∂–∏–º: —Å–æ—Ç—Ä—É–¥–Ω–∏–∫</span>
            <button onclick="showPasswordModal()">–í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω</button>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ —Å –ø–∞—Ä–æ–ª–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        const ADMIN_PASSWORD = '4815162342';
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage
        let shifts = JSON.parse(localStorage.getItem('shifts')) || [];
        let employees = JSON.parse(localStorage.getItem('employees')) || [
            { name: "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤", password: "1234" },
            { name: "–ï–ª–µ–Ω–∞ –°–∏–¥–æ—Ä–æ–≤–∞", password: "5678" },
            { name: "–ê–ª–µ–∫—Å–µ–π –ò–≤–∞–Ω–æ–≤", password: "9012" }
        ];
        
        let currentEmployee = null;
        let isAdminAuthorized = false;

        if (sessionStorage.getItem('adminAuthorized') === 'true') {
            isAdminAuthorized = true;
            updateAdminUI();
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
        function showPasswordModal() {
            document.getElementById('adminPasswordModal').classList.add('active');
            document.getElementById('adminPasswordInput').value = '';
            document.getElementById('adminPasswordInput').focus();
        }

        function hideAdminPasswordModal() {
            document.getElementById('adminPasswordModal').classList.remove('active');
        }

        function showEmployeeLogin() {
            document.getElementById('employeeLoginSection').classList.add('active');
            document.getElementById('employeeSection').classList.remove('active');
            document.getElementById('employerSection').classList.remove('active');
            
            document.querySelectorAll('.role-btn')[0].classList.add('active');
            document.querySelectorAll('.role-btn')[1].classList.remove('active');
            
            updateEmployeeLoginSelects();
        }

        function hideEmployeeLoginModal() {
            document.getElementById('employeeLoginModal').classList.remove('active');
        }

        function checkAdminPassword() {
            const enteredPassword = document.getElementById('adminPasswordInput').value;
            
            if (enteredPassword === ADMIN_PASSWORD) {
                isAdminAuthorized = true;
                sessionStorage.setItem('adminAuthorized', 'true');
                hideAdminPasswordModal();
                updateAdminUI();
                updateEmployeeSelects();
                renderEmployeeList();
                loadAdminShifts();
                switchToAdmin();
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!');
                document.getElementById('adminPasswordInput').value = '';
            }
        }

        function checkEmployeePassword() {
            const employeeName = document.getElementById('employeeLoginSelect').value;
            const password = document.getElementById('employeePasswordInput').value;
            
            const employee = employees.find(e => e.name === employeeName);
            
            if (employee && employee.password === password) {
                currentEmployee = employee;
                hideEmployeeLoginModal();
                switchToEmployeeSection();
                loadEmployeeShifts();
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!');
                document.getElementById('employeePasswordInput').value = '';
            }
        }

        function checkEmployeePasswordMain() {
            const employeeName = document.getElementById('employeeLoginSelectMain').value;
            const password = document.getElementById('employeePasswordInputMain').value;
            
            const employee = employees.find(e => e.name === employeeName);
            
            if (employee && employee.password === password) {
                currentEmployee = employee;
                switchToEmployeeSection();
                loadEmployeeShifts();
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!');
                document.getElementById('employeePasswordInputMain').value = '';
            }
        }

        function logoutEmployee() {
            currentEmployee = null;
            showEmployeeLogin();
        }

        function switchToEmployeeSection() {
            document.getElementById('employeeLoginSection').classList.remove('active');
            document.getElementById('employeeSection').classList.add('active');
            document.getElementById('employerSection').classList.remove('active');
            
            document.getElementById('currentEmployeeName').textContent = currentEmployee.name;
            
            document.querySelectorAll('.role-btn')[0].classList.add('active');
            document.querySelectorAll('.role-btn')[1].classList.remove('active');
        }

        function logoutAdmin() {
            isAdminAuthorized = false;
            sessionStorage.removeItem('adminAuthorized');
            updateAdminUI();
            showEmployeeLogin();
        }

        function updateAdminUI() {
            const adminBtn = document.getElementById('adminBtn');
            const adminLock = document.getElementById('adminLock');
            const adminStatus = document.getElementById('adminStatus');

            if (isAdminAuthorized) {
                adminBtn.style.background = '#4CAF50';
                adminBtn.textContent = '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (–∞–∫—Ç–∏–≤–µ–Ω)';
                adminStatus.innerHTML = 'üëë –†–µ–∂–∏–º: –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
                adminLock.querySelector('button').textContent = '–í—ã–π—Ç–∏';
                adminLock.querySelector('button').onclick = logoutAdmin;
            } else {
                adminBtn.style.background = 'rgba(255,255,255,0.2)';
                adminBtn.textContent = '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
                adminStatus.innerHTML = 'üë§ –†–µ–∂–∏–º: —Å–æ—Ç—Ä—É–¥–Ω–∏–∫';
                adminLock.querySelector('button').textContent = '–í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω';
                adminLock.querySelector('button').onclick = showPasswordModal;
            }
        }

        function switchToAdmin() {
            if (isAdminAuthorized) {
                document.querySelectorAll('.role-btn')[1].classList.add('active');
                document.querySelectorAll('.role-btn')[0].classList.remove('active');
                document.getElementById('employerSection').classList.add('active');
                document.getElementById('employeeSection').classList.remove('active');
                document.getElementById('employeeLoginSection').classList.remove('active');
            } else {
                showPasswordModal();
            }
        }

        function switchAdminTab(tab) {
            document.querySelectorAll('.admin-tab').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('adminEmployeesTab').classList.remove('active');
            document.getElementById('adminShiftsTab').classList.remove('active');
            document.getElementById('adminAddTab').classList.remove('active');
            
            if (tab === 'employees') {
                document.getElementById('adminEmployeesTab').classList.add('active');
            } else if (tab === 'shifts') {
                document.getElementById('adminShiftsTab').classList.add('active');
                loadAdminShifts();
            } else if (tab === 'add') {
                document.getElementById('adminAddTab').classList.add('active');
                document.getElementById('shiftDate').value = new Date().toISOString().split('T')[0];
            }
        }

        function updateEmployeeSelects() {
            const selects = [
                'employeeSelect', 'employeeLoginSelect', 
                'employeeLoginSelectMain', 'adminEmployeeFilter', 'editEmployeeSelect'
            ];
            
            const options = employees.map(emp => 
                `<option value="${emp.name}">${emp.name}</option>`
            ).join('');
            
            selects.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    if (id === 'adminEmployeeFilter') {
                        el.innerHTML = '<option value="">–í—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</option>' + options;
                    } else {
                        el.innerHTML = options;
                    }
                }
            });
        }

        function updateEmployeeLoginSelects() {
            updateEmployeeSelects();
        }

        function renderEmployeeList() {
            const container = document.getElementById('employeesContainer');
            if (!container) return;
            
            container.innerHTML = employees.map((emp, index) => `
                <div class="employee-item">
                    <input type="text" value="${emp.name}" placeholder="–ò–º—è" onchange="updateEmployeeName(${index}, this.value)">
                    <input type="text" value="${emp.password}" placeholder="–ü–∞—Ä–æ–ª—å" onchange="updateEmployeePassword(${index}, this.value)">
                    <button class="btn secondary small" onclick="copyEmployeePassword(${index})">üìã</button>
                    <button class="btn danger small" onclick="deleteEmployee(${index})">‚ùå</button>
                </div>
            `).join('');
        }

        function addNewEmployee() {
            const newName = prompt('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞:');
            if (newName && newName.trim()) {
                const newPassword = Math.floor(1000 + Math.random() * 9000).toString();
                employees.push({ 
                    name: newName.trim(), 
                    password: newPassword 
                });
                localStorage.setItem('employees', JSON.stringify(employees));
                updateEmployeeSelects();
                renderEmployeeList();
                alert(`–ü–∞—Ä–æ–ª—å –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: ${newPassword}`);
            }
        }

        function updateEmployeeName(index, newName) {
            const oldName = employees[index].name;
            if (newName && newName.trim()) {
                employees[index].name = newName.trim();
                
                shifts = shifts.map(shift => {
                    if (shift.employee === oldName) {
                        shift.employee = newName.trim();
                    }
                    return shift;
                });
                
                localStorage.setItem('employees', JSON.stringify(employees));
                localStorage.setItem('shifts', JSON.stringify(shifts));
                updateEmployeeSelects();
                renderEmployeeList();
                loadAdminShifts();
            }
        }

        function updateEmployeePassword(index, newPassword) {
            if (newPassword && newPassword.trim()) {
                employees[index].password = newPassword.trim();
                localStorage.setItem('employees', JSON.stringify(employees));
                renderEmployeeList();
            }
        }

        function copyEmployeePassword(index) {
            navigator.clipboard.writeText(employees[index].password).then(() => {
                alert('–ü–∞—Ä–æ–ª—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
            });
        }

        function deleteEmployee(index) {
            if (employees.length <= 1) {
                alert('–î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫');
                return;
            }
            
            const employeeName = employees[index].name;
            if (confirm(`–£–¥–∞–ª–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ ${employeeName}? –í—Å–µ –µ–≥–æ —Å–º–µ–Ω—ã —Ç–∞–∫–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.`)) {
                employees.splice(index, 1);
                shifts = shifts.filter(shift => shift.employee !== employeeName);
                
                localStorage.setItem('employees', JSON.stringify(employees));
                localStorage.setItem('shifts', JSON.stringify(shifts));
                updateEmployeeSelects();
                renderEmployeeList();
                loadAdminShifts();
            }
        }

        function saveShift() {
            if (!isAdminAuthorized) {
                alert('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–º–µ–Ω—ã!');
                showPasswordModal();
                return;
            }

            const employee = document.getElementById('employeeSelect').value;
            const date = document.getElementById('shiftDate').value;
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            const hourlyRate = parseFloat(document.getElementById('hourlyRate').value);
            
            const taxi = parseFloat(document.getElementById('taxi').value) || 0;
            const otherAllowances = parseFloat(document.getElementById('otherAllowances').value) || 0;
            const fines = parseFloat(document.getElementById('fines').value) || 0;
            const deductions = parseFloat(document.getElementById('deductions').value) || 0;
            const meals = parseFloat(document.getElementById('meals').value) || 0;
            const comment = document.getElementById('shiftComment').value;

            if (!date) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É');
                return;
            }

            const start = new Date(`2000-01-01T${startTime}`);
            const end = new Date(`2000-01-01T${endTime}`);
            const hoursWorked = (end - start) / (1000 * 60 * 60);

            if (hoursWorked <= 0) {
                alert('–í—Ä–µ–º—è —É—Ö–æ–¥–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–∑–∂–µ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏—Ö–æ–¥–∞');
                return;
            }

            const baseEarnings = hoursWorked * hourlyRate;
            const totalAllowances = taxi + otherAllowances;
            const totalDeductions = fines + deductions + meals;
            const finalEarnings = baseEarnings + totalAllowances - totalDeductions;

            const shift = {
                id: Date.now(),
                employee,
                date,
                startTime,
                endTime,
                hoursWorked: hoursWorked.toFixed(2),
                hourlyRate,
                taxi,
                otherAllowances,
                fines,
                deductions,
                meals,
                comment: comment || '',
                totalAllowances: totalAllowances.toFixed(2),
                totalDeductions: totalDeductions.toFixed(2),
                baseEarnings: baseEarnings.toFixed(2),
                finalEarnings: finalEarnings.toFixed(2)
            };

            shifts.push(shift);
            localStorage.setItem('shifts', JSON.stringify(shifts));

            alert('–°–º–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
            
            document.getElementById('shiftDate').value = '';
            document.getElementById('taxi').value = '0';
            document.getElementById('otherAllowances').value = '0';
            document.getElementById('fines').value = '0';
            document.getElementById('deductions').value = '0';
            document.getElementById('meals').value = '0';
            document.getElementById('shiftComment').value = '';
            
            switchAdminTab('shifts');
            loadAdminShifts();
        }

        function loadAdminShifts() {
            const employeeFilter = document.getElementById('adminEmployeeFilter').value;
            const dateFrom = document.getElementById('adminDateFrom').value;
            const dateTo = document.getElementById('adminDateTo').value;
            
            let filteredShifts = [...shifts];
            
            if (employeeFilter) {
                filteredShifts = filteredShifts.filter(shift => shift.employee === employeeFilter);
            }
            if (dateFrom) {
                filteredShifts = filteredShifts.filter(shift => shift.date >= dateFrom);
            }
            if (dateTo) {
                filteredShifts = filteredShifts.filter(shift => shift.date <= dateTo);
            }

            filteredShifts.sort((a, b) => new Date(b.date) - new Date(a.date));

            const shiftsGrid = document.getElementById('adminShiftsGrid');
            if (!shiftsGrid) return;

            if (filteredShifts.length === 0) {
                shiftsGrid.innerHTML = '<div class="no-data">üìÖ –ù–µ—Ç —Å–º–µ–Ω –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥</div>';
                return;
            }

            shiftsGrid.innerHTML = filteredShifts.map(shift => {
                const date = new Date(shift.date);
                const dayOfWeek = date.toLocaleDateString('ru-RU', { weekday: 'short' });
                
                return `
                    <div class="shift-card admin-card" onclick="openEditShiftModal('${shift.id}')">
                        <div class="shift-card-header">
                            <span class="shift-date">${formatDateShort(shift.date)}</span>
                            <span class="shift-day">${dayOfWeek}</span>
                        </div>
                        <div class="shift-preview">
                            <div class="shift-time">
                                <div class="time-label">–ü—Ä–∏—à–µ–ª</div>
                                <div class="time-value">${shift.startTime}</div>
                            </div>
                            <div class="shift-arrow">‚Üí</div>
                            <div class="shift-time">
                                <div class="time-label">–£—à–µ–ª</div>
                                <div class="time-value">${shift.endTime}</div>
                            </div>
                            <div class="shift-total">
                                <div class="total-label">–ò—Ç–æ–≥</div>
                                <div class="total-value">${shift.finalEarnings} ‚ÇΩ</div>
                            </div>
                        </div>
                        <div class="shift-footer">
                            <div class="shift-footer-row">
                                <div class="shift-badge">
                                    <span>üë§ ${shift.employee}</span>
                                </div>
                                <div class="shift-badge">
                                    <span>‚è±Ô∏è ${shift.hoursWorked} —á</span>
                                </div>
                            </div>
                            <div class="shift-footer-row">
                                ${shift.taxi > 0 ? `
                                <div class="shift-badge taxi">
                                    <span>üöñ ${shift.taxi} ‚ÇΩ</span>
                                </div>
                                ` : ''}
                                ${shift.otherAllowances > 0 ? `
                                <div class="shift-badge allowance">
                                    <span>‚ûï ${shift.otherAllowances} ‚ÇΩ</span>
                                </div>
                                ` : ''}
                                ${shift.totalDeductions > 0 ? `
                                <div class="shift-badge deduction">
                                    <span>‚ûñ ${shift.totalDeductions} ‚ÇΩ</span>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function openEditShiftModal(shiftId) {
            const shift = shifts.find(s => s.id == shiftId);
            if (!shift) return;

            document.getElementById('editShiftId').value = shift.id;
            document.getElementById('editEmployeeSelect').value = shift.employee;
            document.getElementById('editShiftDate').value = shift.date;
            document.getElementById('editStartTime').value = shift.startTime;
            document.getElementById('editEndTime').value = shift.endTime;
            document.getElementById('editHourlyRate').value = shift.hourlyRate;
            document.getElementById('editTaxi').value = shift.taxi || 0;
            document.getElementById('editOtherAllowances').value = shift.otherAllowances || 0;
            document.getElementById('editFines').value = shift.fines || 0;
            document.getElementById('editDeductions').value = shift.deductions || 0;
            document.getElementById('editMeals').value = shift.meals || 0;
            document.getElementById('editComment').value = shift.comment || '';

            document.getElementById('editModalTitle').textContent = `–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–º–µ–Ω—ã –æ—Ç ${formatDate(shift.date)}`;
            document.getElementById('editShiftModal').classList.add('active');
        }

        function closeEditModal() {
            document.getElementById('editShiftModal').classList.remove('active');
        }

        function updateShift() {
            const id = parseInt(document.getElementById('editShiftId').value);
            const index = shifts.findIndex(s => s.id === id);
            
            if (index === -1) return;

            const employee = document.getElementById('editEmployeeSelect').value;
            const date = document.getElementById('editShiftDate').value;
            const startTime = document.getElementById('editStartTime').value;
            const endTime = document.getElementById('editEndTime').value;
            const hourlyRate = parseFloat(document.getElementById('editHourlyRate').value);
            const taxi = parseFloat(document.getElementById('editTaxi').value) || 0;
            const otherAllowances = parseFloat(document.getElementById('editOtherAllowances').value) || 0;
            const fines = parseFloat(document.getElementById('editFines').value) || 0;
            const deductions = parseFloat(document.getElementById('editDeductions').value) || 0;
            const meals = parseFloat(document.getElementById('editMeals').value) || 0;
            const comment = document.getElementById('editComment').value;

            if (!date) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É');
                return;
            }

            const start = new Date(`2000-01-01T${startTime}`);
            const end = new Date(`2000-01-01T${endTime}`);
            const hoursWorked = (end - start) / (1000 * 60 * 60);

            if (hoursWorked <= 0) {
                alert('–í—Ä–µ–º—è —É—Ö–æ–¥–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–∑–∂–µ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏—Ö–æ–¥–∞');
                return;
            }

            const baseEarnings = hoursWorked * hourlyRate;
            const totalAllowances = taxi + otherAllowances;
            const totalDeductions = fines + deductions + meals;
            const finalEarnings = baseEarnings + totalAllowances - totalDeductions;

            shifts[index] = {
                ...shifts[index],
                employee,
                date,
                startTime,
                endTime,
                hoursWorked: hoursWorked.toFixed(2),
                hourlyRate,
                taxi,
                otherAllowances,
                fines,
                deductions,
                meals,
                comment: comment || '',
                totalAllowances: totalAllowances.toFixed(2),
                totalDeductions: totalDeductions.toFixed(2),
                baseEarnings: baseEarnings.toFixed(2),
                finalEarnings: finalEarnings.toFixed(2)
            };

            localStorage.setItem('shifts', JSON.stringify(shifts));
            
            alert('–°–º–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!');
            closeEditModal();
            loadAdminShifts();
            
            if (currentEmployee) {
                loadEmployeeShifts();
            }
        }

        function deleteShift() {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å–º–µ–Ω—É?')) return;
            
            const id = parseInt(document.getElementById('editShiftId').value);
            shifts = shifts.filter(s => s.id !== id);
            
            localStorage.setItem('shifts', JSON.stringify(shifts));
            
            alert('–°–º–µ–Ω–∞ —É–¥–∞–ª–µ–Ω–∞');
            closeEditModal();
            loadAdminShifts();
            
            if (currentEmployee) {
                loadEmployeeShifts();
            }
        }

        function resetAdminFilter() {
            document.getElementById('adminEmployeeFilter').value = '';
            document.getElementById('adminDateFrom').value = '';
            document.getElementById('adminDateTo').value = '';
            loadAdminShifts();
        }

        function loadEmployeeShifts() {
            if (!currentEmployee) return;
            
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            
            let filteredShifts = shifts.filter(shift => shift.employee === currentEmployee.name);
            
            if (dateFrom) {
                filteredShifts = filteredShifts.filter(shift => shift.date >= dateFrom);
            }
            if (dateTo) {
                filteredShifts = filteredShifts.filter(shift => shift.date <= dateTo);
            }

            filteredShifts.sort((a, b) => new Date(b.date) - new Date(a.date));

            const totalHours = filteredShifts.reduce((sum, shift) => sum + parseFloat(shift.hoursWorked), 0);
            const totalBaseEarnings = filteredShifts.reduce((sum, shift) => {
                if (shift.baseEarnings) {
                    return sum + parseFloat(shift.baseEarnings);
                } else {
                    return sum + parseFloat(shift.totalEarnings || 0);
                }
            }, 0);
            const totalTaxi = filteredShifts.reduce((sum, shift) => sum + parseFloat(shift.taxi || 0), 0);
            const totalOtherAllowances = filteredShifts.reduce((sum, shift) => sum + parseFloat(shift.otherAllowances || 0), 0);
            const totalDeductions = filteredShifts.reduce((sum, shift) => sum + parseFloat(shift.totalDeductions || 0), 0);
            const totalFinal = filteredShifts.reduce((sum, shift) => sum + parseFloat(shift.finalEarnings), 0);

            document.getElementById('statsContainer').innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">–ß–∞—Å–æ–≤</div>
                    <div class="stat-value">${totalHours.toFixed(1)} —á</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–ü–æ —Å—Ç–∞–≤–∫–µ</div>
                    <div class="stat-value">${totalBaseEarnings.toFixed(0)} ‚ÇΩ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–¢–∞–∫—Å–∏</div>
                    <div class="stat-value positive">+${totalTaxi.toFixed(0)} ‚ÇΩ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–ù–∞–¥–±–∞–≤–∫–∏</div>
                    <div class="stat-value positive">+${totalOtherAllowances.toFixed(0)} ‚ÇΩ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–£–¥–µ—Ä–∂–∞–Ω–æ</div>
                    <div class="stat-value negative">-${totalDeductions.toFixed(0)} ‚ÇΩ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–ò—Ç–æ–≥</div>
                    <div class="stat-value positive">${totalFinal.toFixed(0)} ‚ÇΩ</div>
                </div>
            `;

            const shiftsGrid = document.getElementById('shiftsGrid');

            if (filteredShifts.length === 0) {
                shiftsGrid.innerHTML = '<div class="no-data">üìÖ –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥</div>';
                return;
            }

            shiftsGrid.innerHTML = filteredShifts.map(shift => {
                const date = new Date(shift.date);
                const dayOfWeek = date.toLocaleDateString('ru-RU', { weekday: 'short' });
                const baseEarningsDisplay = shift.baseEarnings || shift.totalEarnings || '0';
                
                return `
                    <div class="shift-card" onclick="showShiftDetails('${shift.id}')">
                        <div class="shift-card-header">
                            <span class="shift-date">${formatDateShort(shift.date)}</span>
                            <span class="shift-day">${dayOfWeek}</span>
                        </div>
                        <div class="shift-preview">
                            <div class="shift-time">
                                <div class="time-label">–ü—Ä–∏—à–µ–ª</div>
                                <div class="time-value">${shift.startTime}</div>
                            </div>
                            <div class="shift-arrow">‚Üí</div>
                            <div class="shift-time">
                                <div class="time-label">–£—à–µ–ª</div>
                                <div class="time-value">${shift.endTime}</div>
                            </div>
                            <div class="shift-total">
                                <div class="total-label">–ò—Ç–æ–≥</div>
                                <div class="total-value">${shift.finalEarnings} ‚ÇΩ</div>
                            </div>
                        </div>
                        <div class="shift-footer">
                            <div class="shift-footer-row">
                                <div class="shift-badge">
                                    <span>‚è±Ô∏è ${shift.hoursWorked} —á</span>
                                </div>
                                ${shift.taxi > 0 ? `
                                <div class="shift-badge taxi">
                                    <span>üöñ ${shift.taxi} ‚ÇΩ</span>
                                </div>
                                ` : ''}
                                ${shift.otherAllowances > 0 ? `
                                <div class="shift-badge allowance">
                                    <span>‚ûï ${shift.otherAllowances} ‚ÇΩ</span>
                                </div>
                                ` : ''}
                                ${shift.totalDeductions > 0 ? `
                                <div class="shift-badge deduction">
                                    <span>‚ûñ ${shift.totalDeductions} ‚ÇΩ</span>
                                </div>
                                ` : ''}
                            </div>
                            ${shift.comment ? '<div class="comment-indicator">üìù –ï—Å—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</div>' : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showShiftDetails(shiftId) {
            const shift = shifts.find(s => s.id == shiftId);
            if (!shift) return;

            const modal = document.getElementById('shiftModal');
            const modalDate = document.getElementById('modalDate');
            const modalDetails = document.getElementById('modalDetails');

            modalDate.textContent = `–°–º–µ–Ω–∞ –æ—Ç ${formatDate(shift.date)}`;
            
            const baseEarningsDisplay = shift.baseEarnings || shift.totalEarnings || '0';
            
            modalDetails.innerHTML = `
                <div class="detail-row">
                    <span class="detail-label">üïê –ü—Ä–∏—à–µ–ª</span>
                    <span class="detail-value">${shift.startTime}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">üèÉ –£—à–µ–ª</span>
                    <span class="detail-value">${shift.endTime}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">‚è±Ô∏è –ß–∞—Å–æ–≤</span>
                    <span class="detail-value">${shift.hoursWorked} —á</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">üí∞ –°—Ç–∞–≤–∫–∞</span>
                    <span class="detail-value">${shift.hourlyRate} ‚ÇΩ/—á</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">üíµ –ü–æ —Å—Ç–∞–≤–∫–µ</span>
                    <span class="detail-value">${baseEarningsDisplay} ‚ÇΩ</span>
                </div>
                
                ${shift.taxi > 0 ? `
                <div class="detail-row" style="background: #e8f5e9;">
                    <span class="detail-label">üöñ –¢–∞–∫—Å–∏</span>
                    <span class="detail-value positive">+${shift.taxi} ‚ÇΩ</span>
                </div>
                ` : ''}
                
                ${shift.otherAllowances > 0 ? `
                <div class="detail-row" style="background: #e8f5e9;">
                    <span class="detail-label">‚ûï –ù–∞–¥–±–∞–≤–∫–∏</span>
                    <span class="detail-value positive">+${shift.otherAllowances} ‚ÇΩ</span>
                </div>
                ` : ''}
                
                ${shift.fines > 0 ? `
                <div class="detail-row" style="background: #ffebee;">
                    <span class="detail-label">‚ö†Ô∏è –®—Ç—Ä–∞—Ñ—ã</span>
                    <span class="detail-value negative">-${shift.fines} ‚ÇΩ</span>
                </div>
                ` : ''}
                
                ${shift.deductions > 0 ? `
                <div class="detail-row" style="background: #ffebee;">
                    <span class="detail-label">üìã –£–¥–µ—Ä–∂–∞–Ω–∏—è</span>
                    <span class="detail-value negative">-${shift.deductions} ‚ÇΩ</span>
                </div>
                ` : ''}
                
                ${shift.meals > 0 ? `
                <div class="detail-row" style="background: #ffebee;">
                    <span class="detail-label">üçΩÔ∏è –ü–∏—Ç–∞–Ω–∏–µ</span>
                    <span class="detail-value negative">-${shift.meals} ‚ÇΩ</span>
                </div>
                ` : ''}
                
                <div class="detail-row" style="background: linear-gradient(135deg, #667eea20, #764ba220); margin-top: 10px;">
                    <span class="detail-label">üíé –ò–¢–û–ì–û</span>
                    <span class="detail-value positive" style="font-size: 1.3em;">${shift.finalEarnings} ‚ÇΩ</span>
                </div>
                
                ${shift.comment ? `
                <div class="comment-box">
                    <div class="detail-label">üìù –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</div>
                    <div class="detail-value">${shift.comment}</div>
                </div>
                ` : ''}
            `;

            modal.classList.add('active');
        }

        function closeShiftModal() {
            document.getElementById('shiftModal').classList.remove('active');
        }

        function resetDateFilter() {
            document.getElementById('dateFrom').value = '';
            document.getElementById('dateTo').value = '';
            loadEmployeeShifts();
        }

        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('ru-RU', options);
        }

        function formatDateShort(dateString) {
            const options = { day: 'numeric', month: 'numeric' };
            return new Date(dateString).toLocaleDateString('ru-RU', options);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('shiftDate').value = today;

        const firstDayOfMonth = new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString().split('T')[0];
        document.getElementById('dateFrom').value = firstDayOfMonth;
        document.getElementById('dateTo').value = today;

        updateEmployeeSelects();

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π
        document.getElementById('adminPasswordInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') checkAdminPassword();
        });

        document.getElementById('employeePasswordInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') checkEmployeePassword();
        });

        document.getElementById('employeePasswordInputMain').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') checkEmployeePasswordMain();
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –∏—Ö
        document.getElementById('adminPasswordModal').addEventListener('click', function(e) {
            if (e.target === this) hideAdminPasswordModal();
        });

        document.getElementById('employeeLoginModal').addEventListener('click', function(e) {
            if (e.target === this) hideEmployeeLoginModal();
        });

        document.getElementById('shiftModal').addEventListener('click', function(e) {
            if (e.target === this) closeShiftModal();
        });

        document.getElementById('editShiftModal').addEventListener('click', function(e) {
            if (e.target === this) closeEditModal();
        });

        if (isAdminAuthorized) {
            renderEmployeeList();
            loadAdminShifts();
        }

        // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        document.addEventListener('touchstart', function() {}, {passive: true});
    </script>
</body>
</html>